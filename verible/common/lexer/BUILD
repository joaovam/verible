# 'lexer' contains mostly interfaces and adapters for working with lexers
# in Verible, e.g. those generated by flex.

package(
    default_applicable_licenses = ["//:license"],
    default_visibility = [
        "//verible/common/analysis:__subpackages__",
        "//verible/common/parser:__subpackages__",
        "//verible/verilog/analysis:__subpackages__",
        "//verible/verilog/parser:__subpackages__",
        "//verible/verilog/preprocessor:__subpackages__",
    ],
    features = ["layering_check"],
)

cc_library(
    name = "token-generator",
    hdrs = ["token-generator.h"],
    deps = ["//verible/common/text:token-info"],
)

cc_library(
    name = "token-stream-adapter",
    srcs = ["token-stream-adapter.cc"],
    hdrs = ["token-stream-adapter.h"],
    deps = [
        ":lexer",
        ":token-generator",
        "//verible/common/text:token-info",
        "//verible/common/text:token-stream-view",
        "@abseil-cpp//absl/status",
        "@abseil-cpp//absl/strings:string_view",
    ],
)

cc_library(
    name = "flex-lexer-adapter",
    hdrs = ["flex-lexer-adapter.h"],
    deps = [
        ":lexer",
        "//verible/common/text:token-info",
        "//verible/common/util:logging",
        "@abseil-cpp//absl/log:check",
        "@abseil-cpp//absl/strings:string_view",
    ],
)

cc_library(
    name = "lexer",
    hdrs = ["lexer.h"],
    deps = [
        "//verible/common/text:token-info",
        "@abseil-cpp//absl/strings:string_view",
    ],
)

cc_library(
    name = "lexer-test-util",
    testonly = 1,
    srcs = ["lexer-test-util.cc"],
    hdrs = ["lexer-test-util.h"],
    deps = [
        "//verible/common/text:constants",
        "//verible/common/text:token-info",
        "//verible/common/text:token-info-test-util",
        "//verible/common/util:logging",
        "@abseil-cpp//absl/strings:string_view",
        "@googletest//:gtest",  # for library testonly
    ],
)

cc_test(
    name = "lexer-test-util_test",
    srcs = ["lexer-test-util_test.cc"],
    deps = [
        ":lexer-test-util",
        "//verible/common/text:constants",
        "//verible/common/text:token-info",
        "@abseil-cpp//absl/strings",
        "@abseil-cpp//absl/strings:string_view",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)

cc_test(
    name = "token-stream-adapter_test",
    srcs = ["token-stream-adapter_test.cc"],
    deps = [
        ":lexer",
        ":lexer-test-util",
        ":token-stream-adapter",
        "//verible/common/text:constants",
        "//verible/common/text:token-info",
        "//verible/common/text:token-stream-view",
        "@abseil-cpp//absl/status",
        "@abseil-cpp//absl/strings:string_view",
        "@googletest//:gtest",
        "@googletest//:gtest_main",
    ],
)
